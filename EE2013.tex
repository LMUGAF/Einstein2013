% Dokument Ersti-Einstein WiSe 2013/2014
% für die O-Phase 2013
% ophase-orga@gaf.fs.lmu.de
% Booklet Layout A5 Seiten, komplett 4 Farben
%TODO daher rausfinden, wie man A4-Bögen hiermit druckt --> Es müssen nur normale A5-Bögen eingeliefert werden
%TODO update all to A5 paper size
%TODO transfer changes from markep up print version
%TODO all graphics bleed
%TODO change papersize back to show crop marks
%INFO Formate, etc vom Drucker: http://www.flyeralarm.com/sheets/de/mag_a5_mass.pdf
\documentclass[twoside,openany,a5paper,fontsize=9pt,cleardoublepage=plain]{scrbook}
\usepackage{fancyhdr} % This needs to come before hyperref to avoid errors
\usepackage{iftex}
\ifPDFTeX
		\PackageError{Einstein}{Cannot build with (pdf-)latex}{Bitte mit Xelatex oder Lualatex bauen}
		\stop
\else
	\ifLuaTeX
		\usepackage[ngerman]{babel}
		\usepackage[pdftex]{graphicx} % graphix always before hyperref
		\usepackage[pdftex,hidelinks]{hyperref}
	\else
	% don't switch the order: github.com/reutenauer/polyglossia/issues/50
	\ifXeTeX
		\usepackage{polyglossia}
		\setdefaultlanguage[babelshorthands=true]{german}
		\usepackage{xunicode} % loads graphicx so load it before hyperref
		\usepackage[xetex,hidelinks]{hyperref}
	\fi
\fi
\graphicspath{{img//}{img//daumenkino//}}
\urlstyle{same}
%\urlstyle{tt}

% all referenced packages
\usepackage{calc} %need this for dimension calcs
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage[absolute]{textpos}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{shapes}

\usepackage{dtklogos} % what's this?
\usepackage{multicol} % two col output
\usepackage{multirow} % merge table cells
\usepackage{eurosym} % for euro signs
\usepackage{wrapfig} % wrap text around figures
\usepackage{microtype} % makes line and par breaking nicer
\usepackage{fontspec} % implies fontenc
\usepackage[pagecolor=white]{pagecolor} % after xcolor
\usepackage{afterpage}
\usepackage{environ}
\usepackage{float}
\usepackage{xparse}
\usepackage[parfill]{parskip} %Don't indent paragraphs; newline instead

% sorgt für -- -> \endash
\defaultfontfeatures{Ligatures=TeX}

\usepackage{setspace}
\linespread{1.05}

\usepackage{lscape}
\usepackage{arydshln}

% compact toc
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{0pt}
\setcounter{tocdepth}{2}

\usepackage[babel=once]{csquotes}
\defineshorthand{"`}{\openautoquote}
\defineshorthand{"'}{\closeautoquote}
\DeclareQuoteStyle[quotes]{german}{„}{“}{‚}{‘}

\usepackage{endnotes} %Für alle URLs am Ende des Einsteins
\def\enotesize{\fontsize{9}{12}}
\def\notesname{URLs}
\usepackage{tabularx}
\newcolumntype{L}{>{\raggedright\arraybackslash}p{0.3\textwidth}} % linksbündig mit Breitenangabe

%set up margins with geometry package
\usepackage[twoside,
    a5paper,
    inner=15mm,
    outer=12mm,
    top=17mm,
    bottom=20mm,
    bindingoffset=0mm,
    %showframe    %TODO REMOVE BEFORE PRODUCTION
    ]{geometry}
%use crop package for cropmarks, bleed and stock oversize
\usepackage[cam,
    width=149truemm,
    height=212truemm,
    %mount2
    ]{crop}
% in conjunction with crop: align pages
% centered vertically and inner margin 0 (odd/even different)
\voffset\stockheight
\advance\voffset-\paperheight
\voffset.5\voffset
% shipout package, hook is run every time a page is output.
\usepackage{atbegshi}
\AtBeginShipout{
    \ifodd\value{page}
        %odd pages stick to the left (inside)
        \setlength{\hoffset}{0mm}
    \else
        %even pages stick to the right (inside)
        \setlength{\hoffset}{\stockwidth-\paperwidth}
\fi}

% set up our own dimensions we need
\newlength{\bleed} %bleed = Beschnittzugabe = Anschnitt
\setlength{\bleed}{2mm}
\newlength{\fullwidth} %print size including bleed
\setlength{\fullwidth}{\paperwidth+2\bleed}
\newlength{\fullheight} %e.g. for fullpage images
\setlength{\fullheight}{\paperheight+2\bleed}



\raggedbottom % possibly for the foot notes?


\mathchardef\UrlBreakPenalty=100
\mathchardef\UrlBigBreakPenalty=100



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Add header and flip-book footer to the first page of a chapter
\makeatletter
	\let\ps@plain\ps@fancy
\makeatother


%% Define your own labels
\makeatletter
	\newcommand{\namedlabel}[3]{
		\begingroup
			\def\@currentlabel{#2}
			\def\@currentlabelname{#3}
			\phantomsection\label{#1}
		\endgroup
	}
\makeatother


%% Header
%% http://tex.stackexchange.com/questions/87435/fancyhead-not-in-small-caps
\pagestyle{fancy}

\makeatletter
	\DeclareRobustCommand{\format@sec@number}[2]{{\normalfont\upshape#1}#2}
	
	\renewcommand{\chaptermark}[1]{
		\markboth{\format@sec@number{\ifnum\c@secnumdepth>\m@ne\@chapapp\ \thechapter. \fi}{#1}}{}
	}
\makeatother

\fancyhead[RE,LO]{\itshape\nouppercase{\leftmark}}
\fancyhead[LE,RO]{\thepage}


%% Flip-Book footer
\newcounter{LeftFlipBookFrame}
\setcounter{LeftFlipBookFrame}{30}
\newcounter{RightFlipBookFrame}
\setcounter{RightFlipBookFrame}{1}

\fancyfoot{} %clear all footers
\fancyfoot[LE]{
	\setlength{\unitlength}{1mm}
	%
	\begin{picture}
		(18,0)
		\put(0,0){\includegraphics[height=8mm]{pac-b-\theLeftFlipBookFrame}}
	\end{picture}
	%
	\setcounter{LeftFlipBookFrame}{\theLeftFlipBookFrame-1}
}

\fancyfoot[RO]{
	\setlength{\unitlength}{1mm}
	%
	\begin{picture}
		(18,0)
		\put(0,0){\includegraphics[height=8mm]{pac-a-\theRightFlipBookFrame}}
	\end{picture}
	%
	\setcounter{RightFlipBookFrame}{\theRightFlipBookFrame+1}
}


%% Some trivial macros
\newcommand{\mail}[1]{\href{mailto:#1}{\nolinkurl{#1}}}

\newcommand{\http}{http://}
\newcommand{\https}{https://}

\newcommand{\emd}{\textendash} % dash (used in i.e. phone nums)

\newcommand{\skiptobottom}{\vspace*{0pt plus 1fill}}


%% Set page color
\newcommand{\onepagecolor}[1]{
	\newpagecolor{#1}
	\afterpage{\restorepagecolor}
}


%% Create empty pages
\newenvironment{fullPage}[1][white]{
	\thispagestyle{empty}
	\onepagecolor{#1}
	
	\begin{textblock*}{\paperwidth}(0mm,0mm)
	\noindent
}{
	\end{textblock*}
	\mbox{}
	\clearpage
}


%% urlList
\newcounter{LinkCnt}

\NewEnviron{urlList}{
	\setcounter{LinkCnt}{1}
	
	\vskip 3mm
	
	\colorbox{blue!20}{
		\parbox{.97\textwidth}{
			\begin{tabularx}{\textwidth}{rX}
				\BODY
			\end{tabularx}
		}
	}
}

\newcommand{\urlItem}[3]{%
	% "Close" the last row (create a new one) if not the first link
	\ifnum\theLinkCnt>1%
		\\[2mm]%
	\fi%
	%
	% Create a lable if a label name is provided
	\IfNoValueTF{#3}%
	{}%
	{\namedlabel{#3}{{[}\theLinkCnt{]}}{#1}}%
	%
	% Display the link number, the url and perhaps a description
	\IfNoValueTF{#1}%
	{{[}\theLinkCnt{]} & \url{#2}}%
	{{[}\theLinkCnt{]} & \textbf{#1} \newline \url{#2}}%
	%
	% Increment the link number
	\setcounter{LinkCnt}{\theLinkCnt+1}%
}

\NewDocumentCommand{\httpItem }{omg}{\urlItem{#1}{\http  #2}{#3}}
\NewDocumentCommand{\httpsItem}{omg}{\urlItem{#1}{\https #2}{#3}}


%% Subject lists
\newcommand{\subjectList}[1]{#1}

\DeclareRobustCommand\subjectI {\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectI}}}
\DeclareRobustCommand\subjectM {\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectM}}}
\DeclareRobustCommand\subjectMI{\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectMI}}}
\DeclareRobustCommand\subjectP {\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectP}}}
\DeclareRobustCommand\subjectS {\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectS}}}
\DeclareRobustCommand\subjectW {\hskip 2mm \raisebox{-0.3\height} {\includegraphics[height=5mm]{subjectW}}}


%% Better looking lists
\renewenvironment{itemize}{
	\begin{list}{$\circ$\ }{}
		\setlength{\topsep}   {0pt}
		\setlength{\parskip}  {0pt}
		\setlength{\partopsep}{0pt}
		\setlength{\parsep}   {0pt}
		\setlength{\itemsep}  {1pt}
}{
	\end{list}
}


%% Better looking hash
\newfontface\lserif{Liberation Serif}
\setmainfont{LMU CompatilText} %Remove if you don't have the LMU Compatil Font-series on your device.
\let\oldHash\#
\renewcommand{\#}{{\lserif\oldHash}}


%% Better looking hyphenation
\hyphenation{Im-ma-tri-ku-la-tions-be-schei-ni-gung}


\begin{document}
	\begin{titlepage}
		\begin{fullPage}[black]
			\includegraphics[width=\paperwidth,height=\paperheight]{titel}
		\end{fullPage}
	\end{titlepage}
	
	\begin{fullPage}
		\includegraphics[width=\paperwidth,height=\paperheight]{pacman_and_co__by_maryannasaurr-d4nm40r}
	\end{fullPage}
	
	
	\frontmatter
	\include{impressum}
	\tableofcontents
	
	
	\mainmatter
	\include{vorwort}
	\include{diegaf}
	\include{pcundinternet}
	\include{vorlesungszeit}
	\include{vorlesungsfrei}
	\include{bibliothek}
	\include{gumbel}
	\include{beratung}
	\include{ausland}
	\include{geld}
	\include{ankommen}
	\include{transport}
	
	\appendix
	\include{gebaeude}
	\include{raetsel}
	\include{glossar}
	
	
	\backmatter
	\include{stundenplan}
	
	\cleardoubleevenpage
	\begin{fullPage}
		\includegraphics[width=\paperwidth,height=\paperheight]{mvv_links}
	\end{fullPage}
	
	\begin{fullPage}
		\includegraphics[width=\paperwidth,height=\paperheight]{mvv_rechts}
	\end{fullPage}
	
	\begin{fullPage}
		\includegraphics[width=\paperwidth,height=\paperheight]{lageplan_links}
	\end{fullPage}
	
	\begin{fullPage}
		\includegraphics[width=\paperwidth,height=\paperheight]{lageplan_rechts}
	\end{fullPage}
	
	\begin{fullPage}[black]
		\includegraphics[width=\paperwidth,height=\paperheight]{back}
	\end{fullPage}
\end{document}
